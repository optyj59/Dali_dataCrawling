# 주간 업무 보고

**기간:** 2025년 11월 3일 - 2025년 11월 7일

## I. 금주 진행 상황

### 1. 프로젝트 초기 설정 및 설계
- **프로젝트 생성:** '유튜브 댓글 DWH 구축'을 위한 프로젝트 폴더 구조를 생성했습니다. (`src`, `data`, `logs` 등)
- **아키텍처 설계:** Playwright와 BeautifulSoup을 이용한 크롤링 엔진, PostgreSQL을 이용한 데이터베이스 관리 등 핵심 기술 스택과 데이터 처리 파이프라인을 설계했습니다.
- **데이터베이스 스키마 정의:** `database_schema.md` 파일을 통해 SCD Type 2 이력 관리를 포함한 6개의 테이블 구조를 상세히 설계했습니다.

### 2. 크롤링 엔진 개발 및 개선
- **핵심 기능 구현:** `crawler_engine.py`에 키워드 기반 영상 검색, 메타데이터 추출, 댓글 수집 등 핵심 크롤링 로직을 구현했습니다.
- **댓글 수집 로직 고도화:**
    - 기존의 고정 시간 대기(`sleep`) 방식에서 발생하던 불안정성 문제를 해결하기 위해, Playwright의 `wait_for_load_state('networkidle')`을 사용하는 동적 대기 방식으로 변경하여 모든 댓글을 안정적으로 로드하도록 개선했습니다.
    - 디버깅 과정에서 댓글 섹션을 식별하는 CSS 선택자(`ytd-comments-header-renderer`)가 유효하지 않은 문제를 발견하고, 실제 댓글 스레드를 가리키는 `ytd-comment-thread-renderer`로 교체하여 로딩 성공률을 높였습니다.

### 3. 댓글 수집 기능 디버깅 및 실패 분석
- **문제 상황:** 기존의 동적 대기 방식과 개선된 CSS 선택자를 적용했음에도 불구하고, 특정 영상에서 댓글을 전혀 수집하지 못하는 문제가 지속적으로 발생했습니다.
- **디버깅 과정:** 문제의 원인을 정확히 파악하기 위해, 전체 댓글을 스크롤하며 수집하는 복잡한 로직을 일시적으로 비활성화했습니다. 대신, 페이지 로드 후 첫 화면에 나타나는 소수의 댓글만 수집하는 매우 단순화된 테스트 코드를 작성하여 실행했습니다.
- **실패 분석:** 단순화된 코드조차 댓글 수집에 실패했으며, 실패 시점의 페이지 소스(`debug_page_content.html`)를 분석한 결과, 유튜브 댓글 섹션의 동작 방식에 대한 중요한 사실을 발견했습니다.
    - 페이지 로드 및 스크롤 직후, 댓글 내용이 즉시 DOM에 렌더링되지 않습니다.
    - 처음에는 댓글의 '뼈대(skeleton)'만 자리를 차지하고 있으며, 실제 데이터는 비동기적으로 약간의 시간차를 두고 채워집니다.
    - 이로 인해, 스크립트가 너무 빨리 댓글 내용을 찾으려고 시도하여 '댓글을 찾을 수 없음' 오류가 발생했던 것입니다.
- **결론:** 현재의 단일 대기 방식(예: 스크롤 후 `networkidle` 대기)으로는 안정적인 수집이 불가능하다는 결론에 도달했습니다. 모든 시도가 실패로 돌아가, 이번 주 내 기능 안정화 목표는 달성하지 못했습니다.

## II. 금주 목표
- **댓글 수집 기능 안정화:** 개선된 크롤링 엔진을 최종 테스트하고, 댓글 수와 무관하게 목표 영상의 모든 댓글을 빠짐없이 수집하는 것을 이번 주 최종 목표로 설정합니다. **(미달성)**

## III. 다음 주 계획 (예정)
- **차세대 대기 전략 수립:** 댓글 컨테이너가 나타나는 것을 기다린 후, 그 안에서 실제 댓글 요소가 렌더링될 때까지 추가로 기다리는 2단계 대기 로직을 설계하고 구현합니다.
- 데이터베이스 연동(`db_manager.py`) 개발 착수
- 수집된 데이터의 SCD Type 2 로직 적용 및 저장 기능 구현
